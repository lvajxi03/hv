#!/usr/bin/env python

import os
import fnmatch
import datetime
import ConfigParser

have_windows = False

try:
    import string
    from ctypes import windll
    have_windows = True
except ImportError:
    pass


DEFAULT_MASKS = "*.jpg|*.jpeg|*.png|*.gif|*.bmp|*.tga|" + \
                "*.pcx|*.svg|*ico.|*.tiff|*.tif|*.ppm|*.pnm|*.idraw"

BACKGROUND_NONE = 0
BACKGROUND_WHITE = 1
BACKGROUND_BLACK = 2
BACKGROUND_CHECKERED = 3
BACKGROUND_CUSTOM = 4


def get_max_rect(w1, h1, w2, h2):
    w = w1 if w1 > w2 else w2
    h = h1 if h1 > h2 else h2
    return (w, h)


def get_location(ww, wh, pw, ph):
    x = int((ww - pw)/2)
    y = int((wh - ph)/2)
    return (x, y)


def get_drives():
    drives = []
    if have_windows:
        bitmask = windll.kernel32.GetLogicalDrives()
        for letter in string.uppercase:
            if bitmask & 1:
                drives.append(letter)
            bitmask >>= 1
    return drives


def getfiles(curdir=".", masks=[]):
    try:
        names = []
        os.chdir(curdir)
        if len(masks) > 0:
            for f in os.listdir(curdir):
                if os.path.isfile(f):
                    for mask in masks:
                        if fnmatch.fnmatch(f, mask):
                            names.append(f)
        else:
            for f in os.listdir(curdir):
                if os.path.isfile(f):
                    names.append(f)
        names.sort()

        full = []
        for name in names:
            mtime = os.path.getmtime(name)
            ts = datetime.datetime.fromtimestamp(
                mtime).strftime('%Y-%m-%d %H:%M:%S')
            statinfo = os.stat(name)
            size = statinfo.st_size
            full.append([name, ts, size])

        return full
    except OSError:
        pass
    return []


def getdirs(curdir="."):
    try:
        os.chdir(curdir)
        dirs = []
        for f in os.listdir(curdir):
            if os.path.isdir(f):
                dirs.append(f)
        dirs.sort()
        return dirs
    except OSError:
        pass
    return []


def saveconfig(configuration={}):
    fh = open(os.path.join(os.path.expanduser("~"), ".hvrc"), "w")
    cp = ConfigParser.ConfigParser()
    for key in configuration:
        cp.add_section(key)
        for subkey in configuration[key]:
            cp.set(key, subkey, configuration[key][subkey])
    cp.write(fh)
    fh.close()


def readconfig():
    configuration = {}
    try:
        fh = open(os.path.join(os.path.expanduser("~"), ".hvrc"))
        cp = ConfigParser.ConfigParser()
        cp.readfp(fh)
        for section in cp.sections():
            configuration[section] = {}
            for tuple in cp.items(section):
                configuration[section][tuple[0]] = tuple[1]
        fh.close()
    except IOError:
        pass
    # Saturday night specials:
    if 'settings' in configuration:
        for key in ['centered', 'aspect', 'maximize', 'shrink']:
            try:
                if configuration['settings'][key] == 'True':
                    configuration['settings'][key] = True
                else:
                    configuration['settings'][key] = False
            except KeyError:
                configuration['settings'][key] = False
    return configuration


checkers = [
    "100 100 2 1",
    " 	c #FFFFFF",
    ".	c #DEDEDE",
    "                                                  ..................................................",
    "                                                  ..................................................",
    "                                                  ..................................................",
    "                                                  ..................................................",
    "                                                  ..................................................",
    "                                                  ..................................................",
    "                                                  ..................................................",
    "                                                  ..................................................",
    "                                                  ..................................................",
    "                                                  ..................................................",
    "                                                  ..................................................",
    "                                                  ..................................................",
    "                                                  ..................................................",
    "                                                  ..................................................",
    "                                                  ..................................................",
    "                                                  ..................................................",
    "                                                  ..................................................",
    "                                                  ..................................................",
    "                                                  ..................................................",
    "                                                  ..................................................",
    "                                                  ..................................................",
    "                                                  ..................................................",
    "                                                  ..................................................",
    "                                                  ..................................................",
    "                                                  ..................................................",
    "                                                  ..................................................",
    "                                                  ..................................................",
    "                                                  ..................................................",
    "                                                  ..................................................",
    "                                                  ..................................................",
    "                                                  ..................................................",
    "                                                  ..................................................",
    "                                                  ..................................................",
    "                                                  ..................................................",
    "                                                  ..................................................",
    "                                                  ..................................................",
    "                                                  ..................................................",
    "                                                  ..................................................",
    "                                                  ..................................................",
    "                                                  ..................................................",
    "                                                  ..................................................",
    "                                                  ..................................................",
    "                                                  ..................................................",
    "                                                  ..................................................",
    "                                                  ..................................................",
    "                                                  ..................................................",
    "                                                  ..................................................",
    "                                                  ..................................................",
    "                                                  ..................................................",
    "                                                  ..................................................",
    "..................................................                                                  ",
    "..................................................                                                  ",
    "..................................................                                                  ",
    "..................................................                                                  ",
    "..................................................                                                  ",
    "..................................................                                                  ",
    "..................................................                                                  ",
    "..................................................                                                  ",
    "..................................................                                                  ",
    "..................................................                                                  ",
    "..................................................                                                  ",
    "..................................................                                                  ",
    "..................................................                                                  ",
    "..................................................                                                  ",
    "..................................................                                                  ",
    "..................................................                                                  ",
    "..................................................                                                  ",
    "..................................................                                                  ",
    "..................................................                                                  ",
    "..................................................                                                  ",
    "..................................................                                                  ",
    "..................................................                                                  ",
    "..................................................                                                  ",
    "..................................................                                                  ",
    "..................................................                                                  ",
    "..................................................                                                  ",
    "..................................................                                                  ",
    "..................................................                                                  ",
    "..................................................                                                  ",
    "..................................................                                                  ",
    "..................................................                                                  ",
    "..................................................                                                  ",
    "..................................................                                                  ",
    "..................................................                                                  ",
    "..................................................                                                  ",
    "..................................................                                                  ",
    "..................................................                                                  ",
    "..................................................                                                  ",
    "..................................................                                                  ",
    "..................................................                                                  ",
    "..................................................                                                  ",
    "..................................................                                                  ",
    "..................................................                                                  ",
    "..................................................                                                  ",
    "..................................................                                                  ",
    "..................................................                                                  ",
    "..................................................                                                  ",
    "..................................................                                                  ",
    "..................................................                                                  ",
    "..................................................                                                  "]

